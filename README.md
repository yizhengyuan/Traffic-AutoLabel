# ğŸš— GLM-4.6V äº¤é€šåœºæ™¯è‡ªåŠ¨æ ‡æ³¨ç³»ç»Ÿ

> åŸºäºå¤§æ¨¡å‹çš„è‡ªåŠ¨åŒ–å›¾åƒæ ‡æ³¨æµæ°´çº¿ï¼Œå®ç°äº¤é€šåœºæ™¯ä¸­è¡Œäººã€è½¦è¾†ã€äº¤é€šæ ‡å¿—çš„æ™ºèƒ½æ£€æµ‹ä¸æ ‡æ³¨ã€‚

---

## ğŸ¯ é¡¹ç›®ç®€ä»‹

æœ¬é¡¹ç›®ä½¿ç”¨ **GLM-4.6V** å¤šæ¨¡æ€å¤§æ¨¡å‹ï¼Œå®ç°å¯¹äº¤é€šåœºæ™¯è§†é¢‘å…³é”®å¸§çš„è‡ªåŠ¨æ ‡æ³¨ã€‚æ”¯æŒæ£€æµ‹è¡Œäººã€è½¦è¾†ã€äº¤é€šæ ‡å¿—ã€æ–½å·¥æ ‡å¿—ç­‰å¤šç±»ç›®æ ‡ï¼Œè¾“å‡ºä¸ä¸»æµæ ‡æ³¨è½¯ä»¶ï¼ˆå¦‚ X-AnyLabelingï¼‰å…¼å®¹çš„ JSON æ ¼å¼ã€‚

---

## ğŸ”„ æ ¸å¿ƒæµç¨‹

<p align="center">
  <img src="GLM_Labeling_Manner_1.png" alt="GLM-4.6V è‡ªåŠ¨æ ‡æ³¨æµç¨‹" width="800">
</p>

### 1ï¸âƒ£ æ•°æ®å‡†å¤‡ (Data Preparation)
è„šæœ¬æ ¹æ®å‘½ä»¤è¡Œå‚æ•°ç­›é€‰æŒ‡å®šå‰ç¼€çš„ç›®æ ‡å›¾ç‰‡ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸º Base64 ç¼–ç æ ¼å¼ï¼Œå®Œæˆ API è°ƒç”¨å‰çš„é¢„å¤„ç†å·¥ä½œã€‚

### 2ï¸âƒ£ æ¨¡å‹æ¨ç† (Model Inference)
è°ƒç”¨ **GLM-4.6V** å¤šæ¨¡æ€å¤§æ¨¡å‹ï¼Œé€šè¿‡é¢„è®¾çš„æç¤ºè¯ï¼ˆPromptï¼‰å¼•å¯¼æ¨¡å‹å¯¹å›¾åƒè¿›è¡Œè¯­ä¹‰ç†è§£ï¼Œè¯†åˆ«å‡ºè¡Œäººã€è½¦è¾†ã€äº¤é€šæ ‡å¿—ç­‰ç‰¹å®šç›®æ ‡ï¼Œå¹¶è¿”å›åŸå§‹æ£€æµ‹æ•°æ®ã€‚

### 3ï¸âƒ£ æ•°æ®è§„èŒƒ (Post-Processing)
å¯¹æ¨¡å‹è¿”å›çš„åŸå§‹æ•°æ®è¿›è¡ŒäºŒæ¬¡åŠ å·¥ï¼š
- **åæ ‡è½¬æ¢**ï¼šå°†æ¨¡å‹è¾“å‡ºçš„å½’ä¸€åŒ–ç›¸å¯¹åæ ‡ï¼Œæ¢ç®—ä¸ºå›¾åƒå®é™…çš„ç»å¯¹åƒç´ åæ ‡
- **æ ‡ç­¾æ¸…æ´—**ï¼šé€šè¿‡æ˜ å°„å­—å…¸æ‰§è¡Œæ ‡å‡†åŒ–é€»è¾‘ï¼Œå°†åŒä¹‰è¯ã€ä¸­æ–‡æˆ–ä¸è§„èŒƒæ ‡ç­¾ç»Ÿä¸€è½¬æ¢ä¸ºæ ‡å‡†çš„è‹±æ–‡æ ‡ç­¾

### 4ï¸âƒ£ ç»“æœå¯¼å‡º (Result Export)
å°†æ¸…æ´—åçš„ç»“æ„åŒ–æ•°æ®å°è£…ä¸º JSON æ ¼å¼å¹¶ä¿å­˜ã€‚è¯¥æ ¼å¼ä¸ä¸»æµæ ‡æ³¨è½¯ä»¶ï¼ˆå¦‚ X-AnyLabelingï¼‰å…¼å®¹ï¼Œæ”¯æŒç›´æ¥åŠ è½½ä»¥è¿›è¡Œäººå·¥æ ¡éªŒæˆ–äºŒæ¬¡ç¼–è¾‘ã€‚

---

## ğŸ” RAG ç»†ç²’åº¦åˆ†ç±»

å¯¹äºäº¤é€šæ ‡å¿—çš„ç»†ç²’åº¦åˆ†ç±»ï¼Œæœ¬é¡¹ç›®é‡‡ç”¨ **RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰** æŠ€æœ¯ï¼Œå®ç°å¯¹ 188 ç§æ ‡å‡†äº¤é€šæ ‡å¿—çš„ç²¾å‡†è¯†åˆ«ã€‚

<p align="center">
  <img src="GLM_Labeling_Manner_2.png" alt="RAG ç»†ç²’åº¦åˆ†ç±»æµç¨‹" width="800">
</p>

### æ ¸å¿ƒæµç¨‹
1. **ä¸€é˜¶æ®µç²—åˆ†ç±»**ï¼šé€šè¿‡ GLM-4.6V è¯†åˆ«äº¤é€šæ ‡å¿—çš„å¤§ç±»ï¼ˆé™é€Ÿã€ç¦æ­¢ã€è­¦å‘Šã€æŒ‡ç¤ºç­‰ï¼‰
2. **äºŒé˜¶æ®µç²¾æ’**ï¼šæ ¹æ®å¤§ç±»ä»å‘é‡åº“ä¸­æ£€ç´¢å€™é€‰æ ‡å¿—å›¾ç‰‡
3. **å¤šæ¨¡æ€åŒ¹é…**ï¼šå°†è£å‰ªçš„æ ‡å¿—åŒºåŸŸä¸å€™é€‰å›¾ç‰‡è¿›è¡Œè§†è§‰å¯¹æ¯”
4. **æœ€ç»ˆå†³ç­–**ï¼šè¾“å‡ºæœ€åŒ¹é…çš„æ ‡å‡†æ ‡å¿—åç§°

### æ”¯æŒçš„äº¤é€šæ ‡å¿—ç±»å‹
- **é™é€Ÿæ ‡å¿—**ï¼š`Speed_limit_50_km_h`, `Speed_limit_70_km_h` ç­‰
- **è­¦å‘Šæ ‡å¿—**ï¼š`Road_works_ahead`, `Slippery_road_ahead` ç­‰
- **æŒ‡ç¤ºæ ‡å¿—**ï¼š`Direction_sign`, `Expressway_sign` ç­‰
- **ç¦æ­¢æ ‡å¿—**ï¼š`No_entry`, `No_parking`, `No_stopping` ç­‰

## ğŸ“Š æ£€æµ‹ç±»åˆ«

| ç±»åˆ« | æ ‡ç­¾ç¤ºä¾‹ | é¢œè‰² |
|------|---------|------|
| ğŸ”´ è¡Œäºº | `pedestrian`, `crowd` | çº¢è‰² |
| ğŸŸ¢ è½¦è¾† | `vehicle`, `vehicle_braking`, `vehicle_turning_left`, `vehicle_turning_right`, `vehicle_double_flash` | ç»¿è‰² |
| ğŸ”µ äº¤é€šæ ‡å¿— | `Speed_limit_50_km_h`, `No_stopping`, `Direction_sign`, `Warning_sign`, `Give_way`, `Road_works_ahead` ç­‰ **188 ç§** | è“è‰² |
| ğŸŸ  æ–½å·¥æ ‡å¿— | `traffic_cone`, `construction_barrier` | æ©™è‰² |

### ğŸš— è½¦è¾†è¡Œä¸ºæ ‡ç­¾è¯´æ˜

å½“å‰ç³»ç»Ÿå¯¹è½¦è¾†é‡‡ç”¨**ç»Ÿä¸€ç±»å‹ + è¡Œä¸ºçŠ¶æ€**çš„æ ‡ç­¾è®¾è®¡ï¼š
- `vehicle` - æ­£å¸¸è¡Œé©¶
- `vehicle_braking` - åˆ¹è½¦ï¼ˆåˆ¹è½¦ç¯äº®èµ·ï¼‰
- `vehicle_turning_left` - å·¦è½¬ï¼ˆè½¬å‘ç¯/è½¦èº«å§¿æ€ï¼‰
- `vehicle_turning_right` - å³è½¬ï¼ˆè½¬å‘ç¯/è½¦èº«å§¿æ€ï¼‰
- `vehicle_double_flash` - åŒé—ªï¼ˆå±é™©è­¦å‘Šç¯ï¼‰

> ğŸ’¡ **æ‰©å±•èƒ½åŠ›**ï¼šå¦‚éœ€åŒºåˆ†è½¦è¾†åŸºç¡€ç±»å‹ï¼Œå¯é€šè¿‡ä¿®æ”¹ prompt å¢åŠ ç»†åˆ†æ ‡ç­¾ï¼ˆå¦‚ `car`, `truck`, `bus`, `motorcycle`, `bicycle`, `taxi`, `suv` ç­‰ï¼‰ï¼Œå®ç°æ›´ä¸°å¯Œçš„è½¦è¾†åˆ†ç±»ã€‚

### ğŸš¦ äº¤é€šæ ‡å¿—ç»†ç²’åº¦è¯†åˆ«

ç³»ç»Ÿæ”¯æŒå¯¹ **188 ç§äº¤é€šæ ‡å¿—**çš„ç»†ç²’åº¦è¯†åˆ«ï¼Œæ ‡å¿—åº“æ¥æºäº[é¦™æ¸¯è¿è¾“ç½²å®˜ç½‘](https://www.td.gov.hk/tc/road_safety/road_users_code/index/chapter_7_702_702.html)ã€‚

ä¸»è¦ç±»åˆ«åŒ…æ‹¬ï¼š
- **é™é€Ÿæ ‡å¿—**: `Speed_limit_50_km_h`, `Speed_limit_70_km_h`, `Variable_speed_limit` ç­‰
- **ç¦æ­¢æ ‡å¿—**: `No_entry`, `No_parking`, `No_stopping`, `No_overtaking` ç­‰
- **è­¦å‘Šæ ‡å¿—**: `Road_works_ahead`, `Slippery_road_ahead`, `Children_ahead` ç­‰
- **æŒ‡ç¤ºæ ‡å¿—**: `Direction_sign`, `Expressway_sign`, `One_way_traffic` ç­‰
- **å€’è®¡æ—¶ç‰Œ**: `100m_Countdown_markers`, `200m_Countdown_markers` ç­‰

---

## ğŸ—‚ï¸ æ•°æ®é›†ç»“æ„

ä»¥ D1 æ•°æ®é›†ä¸ºä¾‹ï¼š

```
D1_dataset/
â”œâ”€â”€ ğŸ“„ D1_annotation_report.txt     # æ•°æ®æ ‡æ³¨æ€»ç»“æŠ¥å‘Š
â”œâ”€â”€ ğŸ¬ video/
â”‚   â””â”€â”€ D1.mp4                      # æºè§†é¢‘
â”œâ”€â”€ ğŸ–¼ï¸ frames/
â”‚   â””â”€â”€ D1_frame_*.jpg              # åŸå§‹å…³é”®å¸§ (169å¼ )
â”œâ”€â”€ ğŸ“‹ annotations/
â”‚   â””â”€â”€ D1_frame_*.json             # JSONæ ‡æ³¨æ–‡ä»¶ (169ä¸ª)
â””â”€â”€ ğŸ¨ visualized/
    â””â”€â”€ D1_frame_*_annotated.jpg    # å¯è§†åŒ–æ ‡æ³¨å›¾ç‰‡ (169å¼ )
```

---

## ğŸ“ˆ D1 æ•°æ®é›†ç»Ÿè®¡

| æŒ‡æ ‡ | æ•°å€¼ |
|------|------|
| ğŸ“ æ€»å¸§æ•° | 169 |
| ğŸ“¦ æ€»æ£€æµ‹ç›®æ ‡ | 464 |
| âšª ç©ºå¸§ç‡ | 6.5% |
| ğŸ“ˆ å¹³å‡æ¯å¸§ | 2.75 ä¸ªç›®æ ‡ |

### æ ‡ç­¾åˆ†å¸ƒ Top 10

| æ’å | æ ‡ç­¾ | æ•°é‡ |
|------|------|------|
| 1 | `car` | 251 |
| 2 | `direction_sign` | 55 |
| 3 | `van` | 39 |
| 4 | `suv` | 33 |
| 5 | `motorcycle` | 23 |
| 6 | `taxi` | 15 |
| 7 | `bus` | 15 |
| 8 | `truck` | 11 |
| 9 | `expressway_sign` | 8 |
| 10 | `speed_limit_70` | 4 |

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼ˆæ¨èï¼‰
```bash
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python3 -m venv venv

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source venv/bin/activate   # macOS/Linux
# venv\Scripts\activate    # Windows
```

### 2. å®‰è£…ä¾èµ–
```bash
pip install -r requirements.txt
```

### 3. é…ç½® API Key
```bash
export ZAI_API_KEY="your_api_key_here"
```

### 4. è¿è¡Œæ ‡æ³¨
```bash
# åŸºç¡€æ ‡æ³¨ - D1 ç³»åˆ—å›¾ç‰‡
python3 auto_labeling_universal.py --prefix D1

# RAG å¢å¼ºæ ‡æ³¨ï¼ˆäº¤é€šæ ‡å¿—ç»†ç²’åº¦åˆ†ç±»ï¼‰
python3 auto_labeling_rag.py --prefix D1 --rag

# ä¸¤é˜¶æ®µç²¾ç»†åˆ†ç±»ï¼ˆæ¨èï¼Œæœ€å‡†ç¡®ï¼‰
python3 two_stage_classifier.py --test test_images/extracted_frames/D1_frame_0006.jpg --bbox "733,270,776,300"
```

### 5. ç”Ÿæˆå¯è§†åŒ–
```bash
python3 visualize_universal.py --prefix D1
```

### 6. ç”ŸæˆæŠ¥å‘Š
```bash
python3 generate_report.py --prefix D1
```

### 7. é€€å‡ºè™šæ‹Ÿç¯å¢ƒ
```bash
deactivate
```

---

## ğŸ“ é¡¹ç›®æ–‡ä»¶è¯´æ˜

| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| `auto_labeling_universal.py` | é€šç”¨æ ‡æ³¨è„šæœ¬ï¼Œæ”¯æŒä»»æ„å‰ç¼€çš„å›¾ç‰‡ |
| `auto_labeling_rag.py` | RAG å¢å¼ºæ ‡æ³¨ï¼Œäº¤é€šæ ‡å¿—ç»†ç²’åº¦åˆ†ç±»ï¼ˆ188 ç§æ ‡å‡†æ ‡å¿—ï¼‰ |
| `two_stage_classifier.py` | ä¸¤é˜¶æ®µåˆ†ç±»å™¨ï¼ˆæ¨èï¼‰ï¼Œå…ˆè¯†åˆ«ç±»å‹å†è¯†åˆ«ç»†èŠ‚ |
| `visualize_universal.py` | é€šç”¨å¯è§†åŒ–è„šæœ¬ |
| `generate_report.py` | æ ‡æ³¨æŠ¥å‘Šç”Ÿæˆè„šæœ¬ |
| `rag_sign_classifier.py` | RAG å‘é‡åº“ç®¡ç†å·¥å…· |
| `demo_rag_flow.py` | RAG æµç¨‹æ¼”ç¤ºè„šæœ¬ |

---

## ğŸ“„ è¾“å‡ºæ ¼å¼

æ ‡æ³¨ç»“æœé‡‡ç”¨ **X-AnyLabeling** å…¼å®¹çš„ JSON æ ¼å¼ï¼š

```json
{
  "version": "0.4.1",
  "shapes": [
    {
      "label": "car",
      "points": [[100, 200], [300, 400]],
      "shape_type": "rectangle",
      "flags": {"category": "vehicle"}
    }
  ],
  "imagePath": "D1_frame_0001.jpg",
  "imageHeight": 1080,
  "imageWidth": 1920
}
```

---

## ğŸ”§ æŠ€æœ¯æ ˆ

- **å¤šæ¨¡æ€æ¨¡å‹**: GLM-4.6V
- **Python SDK**: zai-sdk
- **å›¾åƒå¤„ç†**: Pillow
- **è¾“å‡ºæ ¼å¼**: X-AnyLabeling JSON

---

## ğŸ“ License

MIT License

---

<p align="center">
  <b>ğŸš€ Powered by GLM-4.6V</b>
</p>